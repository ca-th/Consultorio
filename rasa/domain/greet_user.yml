version: "3.1"

actions:
  - action_check_existing_user

slots:
  user_name:
    type: text
    mappings:
      - type: from_llm

  cadastro_pessoa_f:
    type: text
    mappings:
      - type: from_llm
    validation:
      rejections:
        - if: not (slots.cadastro_pessoa_f matches "^\d{3}\.\d{3}\.\d{3}-\d{2}$|^\d{11}$")
          utter: utter_invalid_cpf
      refill_utter: "utter_refill_cadastro_pessoa_f"
      
  # user_type:
  #   type: text
  #   mappings:
  #     - type: from_llm
  #   influence_conversation: true

  user_exists:
    type: bool
    mappings:
      - type: controlled

responses:
  utter_greet_user:
    - text: "Olá sejá bem-vindo ao nosso atendimento inteligente de agendamento de consultas!"
  
  utter_ask_user_name:
    - text: "Você poderia me informar seu nome?"

  utter_ask_cadastro_pessoa_f:
    - text: "Agora seu CPF, por favor."

  utter_inexistant_user:
    - text: "Esse usuário não possui uma conta, vamos realizar o seu registro"

  utter_invalid_cpf:
    - text: "CPF inválido"

  utter_refill_cadastro_pessoa_f:
    - text: "Digite um CPF válido"

  utter_introduce_user:
    - text: |
        Seja bem vindo a nossa plataforma {user_name}
        Com o que posso te ajudar hoje? 
        Sou capaz de te auxiliar com diversas coisas, seja com suas consultas, seu cadastro e eventuais dúvidas sobre nossas especialidades.