version: "3.1"

rules:

  # --- Básico ---
  - rule: Saudacao
    steps:
      - intent: greet
      - action: utter_greet

  - rule: Despedida
    steps:
      - intent: goodbye
      - action: utter_goodbye

  - rule: Identidade do bot
    steps:
      - intent: bot_challenge
      - action: utter_iamabot

  # --- Pergunta ao LLM (uso geral) ---
  - rule: Pergunta ao LLM
    steps:
      - intent: perguntar_ao_llm
      - action: utter_ask_llm
      - action: action_perguntar_llm

  # --- Agendamento: ativar formulário ---
  - rule: Ativar agendamento consulta
    steps:
      - intent: agendar_consulta
      - action: agendamento_consulta_form
      - active_loop: agendamento_consulta_form

  # --- Cancelar agendamento durante preenchimento ---
  - rule: Cancelar agendamento durante form
    condition:
      - active_loop: agendamento_consulta_form
    steps:
      - or:
          - intent: negar
          - intent: stop
      - action: utter_agendamento_cancelado
      - action: action_reset_slots
      - active_loop: null

  # --- Agendamento: formulário foi preenchido ---
  - rule: Mostrar resumo do agendamento
    condition:
      - active_loop: agendamento_consulta_form
    steps:
      - action: agendamento_consulta_form
      - active_loop: null
      - action: action_confirmar_agendamento

  # --- Confirmar agendamento após o resumo ---
  - rule: Confirmar agendamento
    steps:
      - intent: affirm
      - action: action_submit_agendamento

  # --- Cancelar agendamento após o resumo ---
  - rule: Nao confirmar agendamento
    steps:
      - intent: negar
      - action: utter_agendamento_cancelado
      - action: action_reset_slots

  # --- FAQs ---
  - rule: Mostrar horario geral
    steps:
      - intent: ask_horario_geral
      - action: utter_horario_geral

  - rule: Usar LLM para serviços
    steps:
      - intent: ask_servicos
      - action: action_perguntar_llm

  - rule: Mostrar horario medico especifico
    steps:
      - intent: ask_horario_medico_especifico
      - action: utter_horario_medico_info

  - rule: Mostrar contato
    steps:
      - intent: ask_contato
      - action: utter_contato

  - rule: Mostrar endereco
    steps:
      - intent: ask_endereco
      - action: utter_endereco

  - rule: Mostrar telefone
    steps:
      - intent: ask_telefone
      - action: utter_telefone

  - rule: Mostrar email
    steps:
      - intent: ask_email
      - action: utter_email
