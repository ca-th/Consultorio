version: "3.1"

recipe: default.v1
language: pt
assistant_id: 20230405-114328-tranquil-mustard

intents:
  - greet
  - goodbye
  - affirm
  - deny
  - thank_you
  # --- Intenções do Formulário (mantidas para Histórias) ---
  - inform_especialidade
  - inform_data_hora
  - inform_nome_medico
  - inform_motivo
  - inform_motivo_consulta_tipo
  # --- Intenções ADICIONADAS para corresponder às Regras ---
  - inform_nome
  - bot_challenge
  - perguntar_ao_llm # Nome unificado (antes era ask_llm)
  - agendar_consulta
  - stop
  - ask_horario_geral
  - ask_servicos
  #- ask_exames
  - ask_horario_medico_especifico
  - ask_contato
  - ask_endereco
  - ask_telefone
  - ask_email

entities:
  - especialidade
  - data_consulta
  - hora_consulta
  - nome_medico
  - motivo_consulta
  - motivo_consulta_tipo

slots:
  user_name:
    type: text
    influence_conversation: true
    mappings:
      - type: from_text
        conditions:
          - active_loop: greet_user
          - requested_slot: user_name

  especialidade:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: especialidade

  data_consulta:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: data_consulta

  hora_consulta:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: hora_consulta

  nome_medico:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: nome_medico
        conditions:
          - active_loop: agendamento_consulta_form
      - type: from_text
        conditions:
          - active_loop: agendamento_consulta_form
          - requested_slot: nome_medico

  motivo_consulta:
    type: text
    influence_conversation: true
    mappings:
      - type: from_text
        conditions:
          - active_loop: agendamento_consulta_form
          - requested_slot: motivo_consulta
  
  motivo_consulta_tipo:
    type: text
    influence_conversation: true
    mappings:
      - type: from_text
        conditions:
          - active_loop: agendamento_consulta_form
          - requested_slot: motivo_consulta_tipo

forms:
  agendamento_consulta_form:
    required_slots:
      - motivo_consulta_tipo
      - especialidade
      - data_consulta
      - hora_consulta
      - nome_medico
      - motivo_consulta

actions:
  - action_perguntar_llm
  - validate_agendamento_consulta_form
  - action_submit_agendamento

responses:
  utter_greet:
    - text: "Olá! Como posso ajudar você hoje?"

  utter_user_name:
    - text: "Poderia informar o seu nome?"

  utter_introduce_user:
    - text: "Prazer em conhecê-lo, {user_name}! Sou o assistente virtual do Consultório. Como posso ajudar você hoje?"

  utter_goodbye:
    - text: "Até logo!"


  # Perguntas do formulário
  utter_ask_especialidade:
    - text: "Para qual especialidade você gostaria de agendar a consulta?"
  utter_ask_data_consulta:
    - text: "Para qual dia você gostaria de agendar? Ex.: 'amanhã', 'quarta-feira', '25 de julho'."
  utter_ask_hora_consulta:
    - text: "E qual horário seria ideal? Ex.: '10h', 'às 14h'."
  utter_ask_nome_medico:
    - text: "Você tem preferência de médico? Se sim, informe o nome."
  utter_ask_motivo_consulta:
    - text: "Qual o motivo da consulta?"

  # Resumo antes da confirmação
  utter_submit_agendamento_consulta_form:
    - text: "Confirmando: {especialidade} em {data_consulta} às {hora_consulta} com {nome_medico} (motivo: {motivo_consulta}). Posso confirmar?"

  utter_forms_deactivated:
    - text: "Ok, cancelado."

  utter_ask_especialidade_info:
    - text: "Qual especialidade você gostaria de consultar?"

  utter_horario_geral:
    - text: "Nosso horário de funcionamento é de segunda a sexta, das 8h às 18h."

  utter_horario_medico_info:
    - text: "Para saber o horário de um médico específico, por favor, me diga o nome do médico."

  utter_contato:
    - text: "Você pode entrar em contato através do telefone (XX) XXXX-XXXX ou pelo e-mail contato@clinica.com."

  utter_endereco:
    - text: "Nosso endereço é Rua da Clínica, 123, Bairro Saúde, Cidade-UF."

  utter_telefone:
    - text: "Nosso telefone para contato é (XX) XXXX-XXXX."

  utter_email:
    - text: "contato@consultoriosaude.com.br."

  # LLM
  utter_ask_llm:
    - text: "Processando..."
  utter_debug_llm_call:
    - text: "DEBUG: Chamando LLM..."

session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: true