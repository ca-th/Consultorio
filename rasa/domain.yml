version: "3.6"

recipe: default.v1
language: pt
assistant_id: 20230405-114328-tranquil-mustard

intents:
  - greet
  - goodbye
  - affirm
  - deny
  - bot_challenge
  - agendar_consulta
  - inform_especialidade
  - inform_data_hora
  - inform_nome_medico
  - inform_motivo
  - stop
  - ask_horario_geral
  - ask_servicos
  - ask_horario_medico_especifico
  - ask_contato
  - ask_endereco
  - ask_telefone
  - ask_email
  - fornecer_cpf
  - perguntar_ao_llm

entities:
  - especialidade
  - data_consulta
  - hora_consulta
  - nome_medico
  - motivo_consulta
  - cadastro_pessoa_f
  - motivo_consulta_tipo # Adicionando a entidade, se necessário

slots:
  especialidade:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: especialidade
        conditions:
          - active_loop: agendamento_consulta_form

  data_consulta:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: data_consulta
        conditions:
          - active_loop: agendamento_consulta_form

  hora_consulta:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: hora_consulta
        conditions:
          - active_loop: agendamento_consulta_form

  nome_medico:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: nome_medico
        conditions:
          - active_loop: agendamento_consulta_form
      - type: from_text
        conditions:
          - active_loop: agendamento_consulta_form
          - requested_slot: nome_medico
  
  motivo_consulta:
    type: text
    influence_conversation: true
    mappings:
      - type: from_text
        conditions:
          - active_loop: agendamento_consulta_form

  motivo_consulta_tipo:
    type: text
    influence_conversation: false
    mappings:
      - type: from_text
        conditions:
          - active_loop: agendamento_consulta_form

  cadastro_pessoa_f:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: cadastro_pessoa_f

forms:
  agendamento_consulta_form:
    required_slots:
      - motivo_consulta_tipo
      - especialidade
      - data_consulta
      - hora_consulta
      - nome_medico
      - motivo_consulta
    # Esta linha é a mais importante. Ela diz ao Rasa para chamar a ação customizada
    # para perguntar por cada slot, em vez de usar as respostas pre-definidas.
    ask_slot_action: action_perguntar_slot_llm

responses:
  utter_greet:
    - text: "Olá! Como posso ajudar você hoje?"
  utter_goodbye:
    - text: "Até mais!"
  utter_iamabot:
    - text: "Eu sou um bot, treinado pelo Rasa."

  # Resumo antes da confirmação
  utter_submit_agendamento_consulta_form:
    - text: "Confirmando: {especialidade} em {data_consulta} às {hora_consulta} com {nome_medico} (motivo: {motivo_consulta}). Posso confirmar?"

  utter_forms_deactivated:
    - text: "Tudo bem, cancelei o processo de agendamento."

  # FAQs
  utter_horario_geral:
    - text: "Atendimento: seg-sex 8h-18h; sáb 8h-12h."
  utter_servicos_medicos:
    - text: "Serviços: Consulta Geral, Pediatria, Cardiologia, Dermatologia. Quer agendar?"
  utter_horario_medico_info:
    - text: "Cada médico tem horário próprio. Me diga o nome e verifico."
  utter_contato:
    - text: "Contato: (61) 9986-54583 | contato@consultoriosaude.com.br"
  utter_endereco:
    - text: "Rua da Saúde, 123 - Centro, Cidade, Brasil."
  utter_telefone:
    - text: "(61) 9986-54583."
  utter_email:
    - text: "contato@consultoriosaude.com.br."

actions:
  - action_perguntar_llm
  - action_perguntar_slot_llm
  - validate_agendamento_consulta_form
  - action_submit_agendamento
  # (Opcional) action_store_cpf se quiser tratar fornecer_cpf

session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: true